;; Keyboard configuraion
(defcfg
    danger-enable-cmd yes ;; Enable commands
    log-layer-changes no
    sequence-input-mode visible-backspaced
)

(defsrc
  esc  f1   f2   f3   f4   f5   f6   f7   f8   f9   f10  f11  f12  ins prnt del   pp   mute prev next
  grv  1    2    3    4    5    6    7    8    9    0    -    =    bspc           nlck kp/  kp*  kp-
  tab  q    w    e    r    t    y    u    i    o    p    [    ]    ret            kp7  kp8  kp9
  caps a    s    d    f    g    h    j    k    l    ;    '          \             kp4  kp5  kp6  kp+
  lsft 102d z    x    c    v    b    n    m    ,    .    /    rsft      up        kp1  kp2  kp3
  lctl lmet lalt           spc            ralt rmet rctl left down rght      kp0       kp.  kprt
)

;; Left hand home row chords
(defvar
    chord-timeout 26
)

;; Home-Row Left-Hand
(defalias
  kaboom (cmd bash -c "sudo killall kanata")

  r (chord main r)
  s (chord main s)
  n (chord main n) ;; tmp
  d (chord main d)
)
(defchords main $chord-timeout
  (r     ) r
  ( s    ) s
  (   n  ) (tap-hold-release 200 390 n lmet)
  (    d ) d
  (s n   ) esc
  (s r   ) (one-shot 1000 lctl) ;; s+r=control
  (  n d ) (one-shot 1000 lalt) ;; s+r=control
)

;; Home-Row Right-Hand
(defalias
  a (chord mainr a)
  e (chord mainr e)
  i (chord mainr i)
  h (chord mainr h)
)
(defchords mainr $chord-timeout
  (a     ) a
  ( e    ) (fork e u (a))
  (   i  ) i
  (    h ) h
  (e i   ) ret
  (e a   ) (one-shot 1000 lctl) ;; e+a=control
  (  i h ) S-; ;; e+a=control
)

;; tmp
(defseq "git status" (r s n))
(deffakekeys
  "git status" (macro g i t spc s t a t u s)
)

(defalias
  ;; 'm' on press, 'l' when rolled with 'f' (for 'fl' biagram)
  m (fork (fork m (macro bspc l) (v)) l (f p)) ;; mvm - stumble
  t (tap-hold-release 200 200 t (layer-toggle nav)) ;; tmp
  v (fork v b (m))
)

(defalias
    onesft (one-shot-press-pcancel 1000 (layer-toggle shifted))
    shft (tap-hold-release 200 200 @onesft 1)
)

;; UY chord
(defalias
  u (chord kyu u)
  y (chord kyu y)
)
(defchords kyu $chord-timeout
  (u) u
  (y) (fork y (macro bspc q u u) (u))
  (u y) (macro q u)
)

;; jf chord
(defalias
  j (chord rsnd j)
  f (chord rsnd f)
)
(defchords rsnd $chord-timeout
  (j) j
  (f) (fork f (macro bspc z) (j))
  (j f) z
)

;; copy/paste

(defalias
  g (chord cp g)
  l (chord cp l)
  c (chord cp c)
)
(defchords cp $chord-timeout
    (g) g
    (l) l
    (c) (fork c p (l))
    (g l) C-c
    (l c) C-v
    (g l c) C-a
)

(defalias
  question (fork (macro S-/) (macro bspc S-9) (/))
)

(deflayer main
  @kaboom  XX   XX   XX   XX   XX   XX   XX   XX   XX   XX  XX  XX  XX XX XX   XX   XX XX XX
  lrld   @j    XX    @f    @m    p   @v    XX    XX    .    /    @question    '    bspc           XX XX  XX  XX
  tab  @r    @s    @n    @d    w    XX    XX    ,    @a    @e    @i    @h    ;            XX  XX  XX
  x @g    @l    @c    b    XX    XX    XX    -    @u    o    @y          k             XX  XX  XX  XX
  XX (layer-switch qwerty) XX    XX    (tap-hold-release 222 222 @onesft lctl)    (layer-toggle mouse)    XX    XX    (tap-hold-release 222 222 spc (layer-toggle sym))  @onesft XX  XX XX     XX                XX  XX  XX
  XX XX XX           @t            XX  XX XX XX XX      XX       XX XX  XX
)

(deflayer shifted
  S-esc  f1   f2   S-f3   S-f4   S-f5   S-f6   S-f7   S-f8   S-f9   S-f10  S-f11  S-f12  S-ins S-prnt S-del   pp   mute  prev XX
  lrld (macro S-j) 1    (macro S-f)    (macro S-m)    (macro S-p)    S-v    S-7    S-8    S-grv    S-7    S-/    (macro S-')    XX           S-nlck S-kp/  S-kp*  S-kp-
  S-tab  (macro S-r)    (macro S-s)        (macro S-n)    (macro S-d)    (macro S-w)    (macro S-y)    (macro S-u)    S-\    (macro S-a)    (macro S-e)    (macro S-i)    (macro S-h)    grv              S-kp7  S-kp8  S-kp9
  (macro S-x)    (macro S-g)    (macro S-l)    (macro S-c)    (macro S-b)    (macro S-g)    (macro S-h)    (macro S-j)    S-=    (macro S-u)    (macro S-o)    (macro S-y)         (macro S-k)            S-kp4  S-kp5  S-kp6  S-kp+
  S-lsft 102d (macro S-z)    (macro S-x)    (macro S-c)    (macro S-v)    (macro S-b)    (macro S-n)    (macro S-m)    S-ret    S-.    S-/    S-rsft      S-up        S-kp1  S-kp2  S-kp3
  S-lctl S-lmet S-lalt           (macro S-t)            S-ralt S-rmet S-rctl S-left S-down S-rght      S-kp0       S-kp.  S-kprt
)

;; Symbols
(deflayer sym
  XX XX   XX   f3   f4   f5   f6   f7   f8   f9   f10  f11  f12  ins prnt del   pp   mute  prev XX
  lrld grv    0    [ ]   S-5    6    7    8    S-4    S-,    S-.    \    bspc           nlck kp/  kp*  kp-
  tab  S-7   S-9        S-[    S-1    w    y    u    -    S-- S-8 S-;  (multi (release-key lshft) =)   k              kp7  kp8  kp9
  x    g    S-4   S-2     S-3    g    h    j    k    u    o    y         ret            kp4  kp5  kp6  kp+
  lsft 102d z    x    c    v    b    n    m    spc    .    /    rsft      up        kp1  kp2  kp3
  lctl lmet lalt           spc            ralt rmet rctl left down rght      kp0       kp.  kprt
)

;; Mouse aliases
(defalias
    mwdwn  (mwheel-down  50 120)
    mwup   (mwheel-up    50 120)
    mwlft  (mwheel-left  50 120)
    mwrght (mwheel-right 50 120)

    mmlft (movemouse-accel-left 5 1000 1 15)
    mmdwn (movemouse-accel-down 5 1000 1 15)
    mmup  (movemouse-accel-up   5 1000 1 15)
    mmrgt (movemouse-accel-right 5 1000 1 15)
)

(deflayer mouse
  @kaboom   XX   XX   f3   f4   f5   f6   f7   f8   f9   f10  f11  f12  ins prnt del   pp   mute  prev XX
  lrld j    0    f    m    p    6    7    8    9     @mwdwn   @mwup    =    bspc           nlck kp/  kp*  kp-
  tab  XX XX XX     lsft    w    y    u    @mwlft    @mmlft @mmdwn @mmup @mmrgt    @mwrght              kp7  kp8  kp9
  x    g    l    c    b    g    h    j    k    u    o    y         ret            kp4  kp5  kp6  kp+
  lsft 102d z    x    mrgt    v    b    n    mrgt    spc    .    /    rsft      up        kp1  kp2  kp3
  lctl lmet lalt           mlft            ralt rmet rctl left down rght      kp0       kp.  kprt
)

(deflayer nav
  XX  XX   XX   XX   XX   XX   XX   XX   XX   XX   XX  XX  XX  XX XX XX   XX   XX XX XX
  lrld  j    XX    f    @m    p    v    XX    XX    XX    XX    XX    XX    bspc           XX XX  XX  XX
  sldr  @r    @s    @n    @d    w    XX    XX    ,    lft down up rght    ;            XX  XX  XX
  x g    l    c    b    XX    XX    XX    XX    u    pgdn    pgup          k             XX  XX  XX  XX
  XX (layer-switch qwerty) XX    XX    XX    XX    XX    XX    spc  XX XX  XX XX     XX                XX  XX  XX
  XX XX XX           @t            XX  XX XX XX XX      XX       XX XX  XX
)

;; tmp
(deflayer qwerty
  esc  f1   f2   f3   f4   f5   f6   f7   f8   f9   f10  f11  f12  ins prnt del   pp   mute prev next
  grv  1    2    3    4    5    6    7    8    9    0    -    =    bspc           nlck kp/  kp*  kp-
  tab  q    w    e    r    t    y    u    i    o    p    [    ]    ret            kp7  kp8  kp9
  caps a    s    d    f    g    h    j    k    l    ;    '          \             kp4  kp5  kp6  kp+
  lsft (layer-switch main) z    x    c    v    b    n    m    ,    .    /    rsft      up        kp1  kp2  kp3
  lctl lmet lalt           spc            ralt rmet rctl left down rght      kp0       kp.  kprt
)

